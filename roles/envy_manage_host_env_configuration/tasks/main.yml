---
- name: Create env directory structure
  file:
    path:     "{{ item }}"
    state:    directory
    mode:     0755
  loop:
    - "env-{{ env_name }}"
    - "env-{{ env_name }}/ssh"
    - "env-{{ env_name }}/utilities"

- name: Generate lab static inventory file
  template:
    src:      lab_inventory.j2
    dest:     "env-{{ env_name }}"

- name: Copy vagrant key to lab/ssh
  copy:
    src:      vagrant.private
    dest:     "env-{{ env_name }}/ssh/vagrant.private"
    mode:     0400

- name: Write ansible lab config files
  template:
    src:     "{{ item.file }}.j2"
    dest:    "env-{{ env_name }}/{{ item.directory }}/{{ item.file }}"
  loop:     "{{ env_files }}"
...
